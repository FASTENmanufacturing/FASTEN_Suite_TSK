<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:adm="http://github.com/adminfaces"
                xmlns:of="http://omnifaces.org/functions"
                template="#{layoutMB.template}">

    <ui:define name="head-end">
        <ui:param name="renderBreadCrumb" value="false"/>
        <script type="text/javascript">
	    function onMessage(gson, channel, event) {
	    	var json = JSON.parse(gson);
//             console.log('jsf push message::' + json + ", channel ::" + channel + ", event::" + event);
            
            PF('websocketgrowl').renderMessage({
            		summary: json.title, 
            		detail: json.message, 
            		severity: 'warn'
            });
//             PrimeFaces.showMessageInDialog({severity:"INFO 0",summary:"Notification",detail:message,escape:true});
        }
        </script>
        <style type="text/css">
			div.ui-growl {
			    top: 55px;
			    right: 10px;
			    left:auto !important;
			}
        </style>
    </ui:define>
    
    <ui:define name="metadata">
    	 <f:metadata>
            <!-- use view action if you are in a Java EE 7 server: <f:viewAction action="#{carFormMB.init()}"/>-->
<!--             <f:event type="preRenderView" listener="#{webSocketMB.init}"/> -->
            <f:viewAction action="#{webSocketMB.init()}"/>
        </f:metadata>
    </ui:define>
    
    <ui:define name="title">
        Push test
    </ui:define>
    
    <ui:define name="body">
        <p:growl  widgetVar="websocketgrowl" keepAlive="true" sticky="true" showDetail="true" showSummary="true"/>
        <f:websocket channel="kafkaOutputChannel" onmessage="onMessage" />
    </ui:define>

</ui:composition>
